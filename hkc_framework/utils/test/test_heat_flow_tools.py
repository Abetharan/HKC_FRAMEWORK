import pytest
import numpy as np 
import os 
import sys
from scipy import constants
mp = constants.value("proton mass")
BOLTZMANN_CONSTANT = constants.value("Boltzmann constant")
ELECTRON_MASS = constants.value("electron mass")
PROTON_MASS = constants.value("proton mass")
ELEMENTARY_CHARGE = constants.value("elementary charge")
VACUUM_PERMITTIVITY = 8.854188E-12    # Vacuum dielectric constant
PLANCK_CONSTANT = constants.value("Planck constant")
BOHR_RADIUS = constants.value("Bohr radius")
myPath = os.path.dirname(os.path.abspath(__file__))
sys.path.insert(0, myPath + '/../../../')
from hkc_framework.utils.heat_flow_coupling_tools import HeatFlowCouplingTools


class TestHFCT():

    def test_spitzer_harm(self):
        true_sh = np.array([5.75922288e+15, 7.37788099e+15, 7.96809001e+15, 8.59090379e+15,
       9.75644720e+15, 1.17071165e+16, 1.45091909e+16, 1.80604680e+16,
       2.18283944e+16, 2.53601534e+16, 2.86952743e+16, 3.17744407e+16,
       3.45701022e+16, 3.70855012e+16, 3.93610335e+16, 4.14955737e+16,
       4.36013839e+16, 4.57347061e+16, 4.78701565e+16, 4.99643811e+16,
       5.20029633e+16, 5.39898816e+16, 5.59476435e+16, 5.79268948e+16,
       5.99404032e+16, 6.19555503e+16, 6.39387458e+16, 6.58594250e+16,
       6.77077952e+16, 6.94877527e+16, 7.12162410e+16, 7.29285789e+16,
       7.46842440e+16, 7.65222174e+16, 7.84311505e+16, 8.04105794e+16,
       8.24702157e+16, 8.46264201e+16, 8.69028284e+16, 8.93358445e+16,
       9.18274966e+16, 9.44008059e+16, 9.72094210e+16, 1.00327461e+17,
       1.03832358e+17, 1.07816103e+17, 1.12395958e+17, 1.17739128e+17,
       1.23633293e+17, 1.29957540e+17, 1.36961282e+17, 1.44780300e+17,
       1.53567997e+17, 1.63506831e+17, 1.74813902e+17, 1.87740858e+17,
       2.03201492e+17, 2.08663966e+17, 2.14450732e+17, 2.20533682e+17,
       2.26928900e+17, 2.33651959e+17, 2.40720624e+17, 2.48154534e+17,
       2.55975258e+17, 2.64206385e+17, 2.72873635e+17, 2.82004302e+17,
       2.91629986e+17, 3.01783250e+17, 3.12500024e+17, 3.23818552e+17,
       3.35781718e+17, 3.48436316e+17, 3.61831674e+17, 3.76020932e+17,
       3.91063889e+17, 4.07021603e+17, 4.23961149e+17, 4.41951668e+17,
       4.61056724e+17, 4.82362142e+17, 4.83697522e+17, 4.85459929e+17,
       4.87232905e+17, 4.89028218e+17, 4.90811410e+17, 4.92628433e+17,
       4.94445177e+17, 4.96261216e+17, 4.98111557e+17, 4.99961825e+17,
       5.01835342e+17, 5.03697045e+17, 5.05593700e+17, 5.07478636e+17,
       5.09398853e+17, 5.11319462e+17, 5.13252092e+17, 5.15196868e+17,
       5.17153849e+17, 5.19123198e+17, 5.21117175e+17, 5.23099830e+17,
       5.25119119e+17, 5.27139462e+17, 5.29172723e+17, 5.31219018e+17,
       5.33278468e+17, 5.35351187e+17, 5.37437287e+17, 5.39549350e+17,
       5.41650594e+17, 5.43790090e+17, 5.45931446e+17, 5.48086802e+17,
       5.50256284e+17, 5.52440026e+17, 5.54638149e+17, 5.56850777e+17,
       5.59090789e+17, 5.61320566e+17, 5.63590323e+17, 5.65849981e+17,
       5.68150011e+17, 5.70452998e+17, 5.72771429e+17, 5.75105454e+17,
       5.77455207e+17, 5.79833874e+17, 5.82202977e+17, 5.84600784e+17,
       5.87028042e+17, 5.89459155e+17, 5.91893667e+17, 5.94370854e+17,
       5.96852249e+17, 5.99350712e+17, 6.01866400e+17, 6.04399470e+17,
       6.06963499e+17, 6.09518927e+17, 6.12105117e+17, 6.14722867e+17,
       6.17332298e+17, 6.19986683e+17, 6.22646584e+17, 6.25325209e+17,
       6.28009032e+17, 6.30738798e+17, 6.33474592e+17, 6.36243652e+17,
       6.39005262e+17, 6.41799935e+17, 6.44614594e+17, 6.47463375e+17,
       6.50305181e+17, 6.53194966e+17, 6.56078029e+17, 6.59009602e+17,
       6.61948841e+17, 6.64909450e+17, 6.67891636e+17, 6.70895619e+17,
       6.73921600e+17, 6.76969802e+17, 6.80040440e+17, 6.83133728e+17,
       6.86249887e+17, 6.89403608e+17, 6.92552320e+17, 6.95753019e+17,
       6.98949028e+17, 7.02197649e+17, 7.05441913e+17, 7.08739412e+17,
       7.12047629e+17, 7.15380890e+17, 7.18724632e+17, 7.22122913e+17,
       7.25532803e+17, 7.28968761e+17, 7.32431059e+17, 7.35919972e+17,
       7.39435767e+17, 7.42993809e+17, 7.46549796e+17, 7.50147972e+17,
       7.53789387e+17, 7.57429399e+17, 7.61112603e+17, 7.64840061e+17,
       7.68566804e+17, 7.72353166e+17, 7.76139297e+17, 7.79985841e+17,
       7.83848166e+17, 7.87725827e+17, 7.91665139e+17, 7.95621161e+17,
       7.99609031e+17, 8.03613526e+17, 8.07681372e+17, 8.11767182e+17,
       8.15886353e+17, 8.20039274e+17, 8.24226324e+17, 8.28447894e+17,
       8.32704379e+17, 8.36996178e+17, 8.41323703e+17, 8.45687356e+17,
       8.50087563e+17, 8.54540939e+17, 8.59000090e+17, 8.63512579e+17,
       8.68063383e+17, 8.72652945e+17, 8.77298128e+17, 8.81950972e+17,
       8.86659656e+17, 8.91425525e+17, 8.96200286e+17, 9.01032485e+17,
       9.05923508e+17, 9.10824725e+17, 9.15785057e+17, 9.20805920e+17,
       9.25838361e+17, 9.30948522e+17, 9.36071233e+17, 9.41272971e+17,
       9.46488283e+17, 9.51766948e+17, 9.57110493e+17, 9.62469193e+17,
       9.67910358e+17, 9.73367805e+17, 9.78909178e+17, 9.84467998e+17,
       9.90112251e+17, 9.95775172e+17, 1.00152508e+18, 1.00729493e+18,
       1.01315338e+18, 1.01903310e+18, 1.02498553e+18, 1.03101242e+18,
       1.03706266e+18, 1.04320581e+18, 1.04937371e+18, 1.05563636e+18,
       1.06192538e+18, 1.06831097e+18, 1.07472456e+18, 1.08121875e+18,
       1.08779549e+18, 1.09440279e+18, 1.10109362e+18, 1.10787003e+18,
       1.11467972e+18, 1.12157608e+18, 1.12856121e+18, 1.13558256e+18,
       1.14269390e+18, 1.14987911e+18, 1.15713929e+18, 1.16449404e+18,
       1.17189035e+18, 1.17938267e+18, 1.18695482e+18, 1.19460807e+18,
       1.20234372e+18, 1.21016311e+18, 1.21806759e+18, 1.22605855e+18,
       1.23413743e+18, 1.24230570e+18, 1.25056482e+18, 1.25891636e+18,
       1.26736187e+18, 1.27588404e+18, 1.28454017e+18, 1.29327734e+18,
       1.30209609e+18, 1.31105417e+18, 1.32009849e+18, 1.32922972e+18,
       1.33850604e+18, 1.34785502e+18, 1.35735316e+18, 1.36692788e+18,
       1.37663672e+18, 1.38648308e+18, 1.39641233e+18, 1.40648242e+18,
       1.41667750e+18, 1.42699996e+18, 1.43747176e+18, 1.44803820e+18,
       1.45875792e+18, 1.46959573e+18, 1.48061185e+18, 1.49175283e+18,
       1.50303994e+18, 1.51447619e+18, 1.52604491e+18, 1.53780715e+18,
       1.54968979e+18, 1.56177264e+18, 1.57398262e+18, 1.58639990e+18,
       1.59895150e+18, 1.61169803e+18, 1.62464479e+18, 1.63773750e+18,
       1.65103727e+18, 1.66452984e+18, 1.67821964e+18, 1.69211126e+18,
       1.70618938e+18, 1.72051744e+18, 1.73504339e+18, 1.74977094e+18,
       1.76476414e+18, 1.77995134e+18, 1.79541556e+18, 1.81108555e+18,
       1.82702464e+18, 1.84322071e+18, 1.85970052e+18, 1.87641233e+18,
       1.89340026e+18, 1.91071187e+18, 1.92829789e+18, 1.94618480e+18,
       1.96436084e+18, 1.98289324e+18, 2.00171409e+18, 2.02090960e+18,
       2.04041281e+18, 2.06029049e+18, 2.08055501e+18, 2.10115924e+18,
       2.12217111e+18, 2.14356451e+18, 2.16540992e+18, 2.18766450e+18,
       2.21034018e+18, 2.23350894e+18, 2.25711054e+18, 2.28123588e+18,
       2.30582661e+18, 2.33095523e+18, 2.35662229e+18, 2.38284697e+18,
       2.40964946e+18, 2.43705105e+18, 2.46505472e+18, 2.49373990e+18,
       2.52305870e+18, 2.55310987e+18, 2.58384920e+18, 2.61535882e+18,
       2.64765315e+18, 2.68076527e+18, 2.71473035e+18, 2.74958578e+18,
       2.78535291e+18, 2.82212682e+18, 2.85988456e+18, 2.89872407e+18,
       2.93869947e+18, 2.97981544e+18, 3.02217977e+18, 3.06584162e+18,
       3.11085294e+18, 3.15733726e+18, 3.20531297e+18, 3.25492964e+18,
       3.30622215e+18, 3.35933826e+18, 3.41437853e+18, 3.47146804e+18,
       3.53074444e+18, 3.59235987e+18, 3.65646803e+18, 3.72329762e+18,
       3.79300758e+18, 3.86587025e+18, 3.94214265e+18, 4.02212975e+18,
       4.10618184e+18, 4.19470477e+18, 4.28816168e+18, 4.38714603e+18,
       4.49229819e+18, 4.60447099e+18, 4.72469721e+18, 4.85432010e+18,
       4.99515319e+18, 5.14981380e+18, 5.32268803e+18, 5.48880295e+18,
       5.63167743e+18, 5.75016607e+18, 5.84361079e+18, 5.91123000e+18,
       5.95262658e+18, 5.96793044e+18, 5.95782583e+18, 5.92346074e+18,
       5.86643110e+18, 5.78865391e+18, 5.69224815e+18, 5.57950674e+18,
       5.45274365e+18, 5.31427610e+18, 5.16637984e+18, 5.01116997e+18,
       4.85066892e+18, 4.68671855e+18, 4.52100317e+18, 4.35502274e+18,
       4.19009407e+18, 4.02738580e+18, 3.86787175e+18, 3.71238179e+18,
       3.56160285e+18, 3.41606319e+18, 3.27620048e+18, 3.14230660e+18,
       3.01458813e+18, 2.89316255e+18, 2.77807141e+18, 2.66928577e+18,
       2.56671912e+18, 2.47024251e+18, 2.37968413e+18, 2.29484534e+18,
       2.21549994e+18, 2.14140733e+18, 2.07231138e+18, 2.00795106e+18,
       1.94805890e+18, 1.89236940e+18, 1.84061771e+18, 1.79254270e+18,
       1.74789350e+18, 1.70642481e+18, 1.66789811e+18, 1.61842543e+18,
       1.57598094e+18, 1.55189335e+18, 1.52960054e+18, 1.50895032e+18,
       1.48979598e+18, 1.47199980e+18, 1.45542935e+18, 1.43996247e+18,
       1.42548283e+18, 1.41188107e+18, 1.39905560e+18, 1.38691060e+18,
       1.37535745e+18, 1.36431257e+18, 1.35370011e+18, 1.34344664e+18,
       1.33348633e+18, 1.32375804e+18, 1.31420382e+18, 1.30477111e+18,
       1.29541154e+18, 1.28607995e+18, 1.27673557e+18, 1.26733939e+18,
       1.25785825e+18, 1.24825904e+18, 1.23851354e+18, 1.22859514e+18,
       1.21848027e+18, 1.20814733e+18, 1.19757676e+18, 1.18675163e+18,
       1.17565647e+18, 1.16427806e+18, 1.15260511e+18, 1.14062774e+18,
       1.12833771e+18, 1.11572809e+18, 1.10279437e+18, 1.08953277e+18,
       1.07594163e+18, 1.06201902e+18, 1.04776683e+18, 1.03318618e+18,
       1.01828033e+18, 1.00305385e+18, 9.87512270e+17, 9.71662070e+17,
       9.55511677e+17, 9.39069619e+17, 9.22346492e+17, 9.05353093e+17,
       8.88101755e+17, 8.70605410e+17, 8.52878589e+17, 8.34936001e+17,
       8.16793597e+17, 7.98468308e+17, 7.79977287e+17, 7.61339057e+17,
       7.42572511e+17, 7.23697112e+17, 7.04733106e+17, 6.85700998e+17,
       6.66622244e+17, 6.47517969e+17, 6.28410162e+17, 6.09321047e+17,
       5.90272679e+17, 5.71287678e+17, 5.52388314e+17, 5.33597016e+17,
       5.14936095e+17, 4.96427746e+17, 4.78093669e+17, 4.59955406e+17,
       4.42033934e+17, 4.24349955e+17, 4.06923344e+17, 3.89773447e+17,
       3.72918906e+17, 3.56377511e+17, 3.40166168e+17, 3.24300897e+17,
       3.08796757e+17, 2.93667622e+17, 2.78926402e+17, 2.64584775e+17,
       2.50653197e+17, 2.37140921e+17, 2.24055873e+17, 2.11404691e+17,
       1.99192694e+17, 1.87423778e+17, 1.76100504e+17, 1.65224116e+17,
       1.54794382e+17, 1.44809803e+17, 1.35267506e+17, 1.26163341e+17,
       1.17491882e+17, 1.09246526e+17, 1.01419534e+17, 9.40021292e+16,
       8.69846269e+16, 8.03565666e+16, 7.41068766e+16, 6.82240933e+16,
       6.26966655e+16, 5.75132484e+16, 5.26631490e+16, 4.81368784e+16,
       4.39267381e+16, 4.00278822e+16, 3.64420070e+16, 3.30267978e+16,
       2.91036860e+16, 2.59739686e+16, 2.30770700e+16, 2.03294130e+16,
       1.56434978e+16, 1.13775314e+16, 8.08519076e+15, 5.77470878e+15,
       4.19777831e+15, 3.09863086e+15, 2.36094999e+15, 2.07971666e+15,
       1.86508580e+15, 1.43721674e+15, 1.05902224e+15, 8.40776228e+14,
       7.17742732e+14, 5.90963494e+14, 4.70504912e+14, 3.68495023e+14,
       2.92153232e+14, 2.29407839e+14, 1.78289172e+14, 1.50276699e+14,
       1.29679169e+14, 1.10111134e+14, 1.06751691e+14, 9.97640782e+13,
       9.81306348e+13, 8.86169949e+13, 7.62176359e+13])
        hfct_obj = HeatFlowCouplingTools()
        fluid_Te = np.loadtxt(os.path.join(myPath,'test_files/gdhohlraum_xmic_5ps_TekeV_interp'), skiprows=1)[:, 1] * 1E3 *(ELEMENTARY_CHARGE/BOLTZMANN_CONSTANT)
        fluid_Z = np.loadtxt(os.path.join(myPath,'test_files/gdhohlraum_xmic_Z_interp'), skiprows=1)[:, 1] 
        fluid_x_grid = np.loadtxt(os.path.join(myPath,'test_files/gdhohlraum_xmic_5ps_separatedsnbWcm2'), skiprows=1)[:, 0]*1e-6
        fluid_ne = np.loadtxt(os.path.join(myPath,'test_files/gdhohlraum_xmic_ne1e20cm3_interp'), skiprows=1)[:, 1] * (1e20 * 1e6)
        fluid_x_centered_grid = np.array([(fluid_x_grid[i] + fluid_x_grid[i+1])/2 for i in range(len(fluid_x_grid) - 1)])
        hfct_obj.electron_temperature = fluid_Te
        hfct_obj.electron_number_density = fluid_ne
        hfct_obj.zbar = fluid_Z
        hfct_obj.cell_wall_coord = fluid_x_grid
        hfct_obj.cell_centered_coord = fluid_x_centered_grid
        # hfct_obj.mass = fluid_mass
        hfct_obj.lambda_ei(hfct_obj.electron_temperature * (BOLTZMANN_CONSTANT/ELEMENTARY_CHARGE), 
                            hfct_obj.electron_number_density,
                            hfct_obj.zbar)
        hfct_obj.spitzerHarmHeatFlow()
        rel_err = 100*(abs(hfct_obj.spitzer_harm_heat[1:-1] - true_sh) / true_sh)
        assert np.nanmax(rel_err) < 1e-6 


    def test_snb(self):
        true_snb_heat_flow = np.array([0,2.73933826e+15, 5.23000919e+15, 7.62047339e+15, 9.99754021e+15,
       1.24230141e+16, 1.49347907e+16, 1.75471329e+16, 2.02502882e+16,
       2.29868960e+16, 2.57113554e+16, 2.84305993e+16, 3.11312775e+16,
       3.38058517e+16, 3.64526516e+16, 3.90759044e+16, 4.16856796e+16,
       4.42727677e+16, 4.68416861e+16, 4.94217013e+16, 5.20148238e+16,
       5.46244695e+16, 5.72556346e+16, 5.99149453e+16, 6.26105192e+16,
       6.53206859e+16, 6.80569085e+16, 7.08398678e+16, 7.36735190e+16,
       7.65643691e+16, 7.95215982e+16, 8.25571892e+16, 8.56860875e+16,
       8.89037352e+16, 9.22312063e+16, 9.56990555e+16, 9.93238862e+16,
       1.03124392e+17, 1.07121559e+17, 1.11338873e+17, 1.15802471e+17,
       1.20512391e+17, 1.25505522e+17, 1.30843751e+17, 1.36573631e+17,
       1.42745234e+17, 1.49412440e+17, 1.56633865e+17, 1.64472115e+17,
       1.72945346e+17, 1.82167946e+17, 1.92212522e+17, 2.03184007e+17,
       2.15204234e+17, 2.28415503e+17, 2.42985056e+17, 2.59111363e+17,
       2.77098906e+17, 2.83064622e+17, 2.89237484e+17, 2.95624771e+17,
       3.02235259e+17, 3.09078209e+17, 3.16163455e+17, 3.23501436e+17,
       3.31103232e+17, 3.38980611e+17, 3.47146080e+17, 3.55612930e+17,
       3.64395356e+17, 3.73508446e+17, 3.82968309e+17, 3.92792138e+17,
       4.02998360e+17, 4.13606727e+17, 4.24638401e+17, 4.36116136e+17,
       4.48064512e+17, 4.60510023e+17, 4.73481448e+17, 4.87010117e+17,
       5.01130270e+17, 5.16062558e+17, 5.17269906e+17, 5.18489617e+17,
       5.19713738e+17, 5.20942511e+17, 5.22175297e+17, 5.23412991e+17,
       5.24654963e+17, 5.25901225e+17, 5.27152464e+17, 5.28408045e+17,
       5.29668432e+17, 5.30932980e+17, 5.32202596e+17, 5.33476418e+17,
       5.34755355e+17, 5.36038769e+17, 5.37326900e+17, 5.38619773e+17,
       5.39917410e+17, 5.41219836e+17, 5.42527302e+17, 5.43839155e+17,
       5.45156317e+17, 5.46478143e+17, 5.47804877e+17, 5.49136544e+17,
       5.50473168e+17, 5.51814775e+17, 5.53161389e+17, 5.54513267e+17,
       5.55869748e+17, 5.57231767e+17, 5.58598670e+17, 5.59970707e+17,
       5.61347904e+17, 5.62730286e+17, 5.64117880e+17, 5.65510712e+17,
       5.66909043e+17, 5.68312204e+17, 5.69721145e+17, 5.71134967e+17,
       5.72554624e+17, 5.73979453e+17, 5.75409707e+17, 5.76845415e+17,
       5.78286604e+17, 5.79733540e+17, 5.81185546e+17, 5.82643346e+17,
       5.84106978e+17, 5.85576003e+17, 5.87050437e+17, 5.88531023e+17,
       5.90017085e+17, 5.91508885e+17, 5.93006452e+17, 5.94509816e+17,
       5.96019247e+17, 5.97534059e+17, 5.99054989e+17, 6.00582079e+17,
       6.02114639e+17, 6.03653653e+17, 6.05198441e+17, 6.06749268e+17,
       6.08305920e+17, 6.09869154e+17, 6.11438285e+17, 6.13013826e+17,
       6.14595081e+17, 6.16182801e+17, 6.17776782e+17, 6.19377303e+17,
       6.20983666e+17, 6.22596872e+17, 6.24215985e+17, 6.25842009e+17,
       6.27474254e+17, 6.29112990e+17, 6.30758252e+17, 6.32410075e+17,
       6.34068492e+17, 6.35733539e+17, 6.37405249e+17, 6.39083659e+17,
       6.40768802e+17, 6.42460967e+17, 6.44159442e+17, 6.45865253e+17,
       6.47577445e+17, 6.49297046e+17, 6.51023101e+17, 6.52756638e+17,
       6.54496955e+17, 6.56244333e+17, 6.57998554e+17, 6.59760410e+17,
       6.61529194e+17, 6.63305190e+17, 6.65088436e+17, 6.66878970e+17,
       6.68676831e+17, 6.70482314e+17, 6.72294701e+17, 6.74114778e+17,
       6.75942598e+17, 6.77777438e+17, 6.79620091e+17, 6.81470607e+17,
       6.83328265e+17, 6.85194116e+17, 6.87067190e+17, 6.88948541e+17,
       6.90837457e+17, 6.92733967e+17, 6.94638883e+17, 6.96551490e+17,
       6.98472078e+17, 7.00400432e+17, 7.02337365e+17, 7.04282161e+17,
       7.06235113e+17, 7.08196266e+17, 7.10165664e+17, 7.12143352e+17,
       7.14129375e+17, 7.16123779e+17, 7.18126608e+17, 7.20137910e+17,
       7.22157729e+17, 7.24186376e+17, 7.26223119e+17, 7.28268771e+17,
       7.30323129e+17, 7.32386241e+17, 7.34458417e+17, 7.36538925e+17,
       7.38628583e+17, 7.40727451e+17, 7.42834797e+17, 7.44951441e+17,
       7.47077442e+17, 7.49212070e+17, 7.51356144e+17, 7.53509728e+17,
       7.55672088e+17, 7.57844313e+17, 7.60025416e+17, 7.62216486e+17,
       7.64416538e+17, 7.66626396e+17, 7.68846126e+17, 7.71074993e+17,
       7.73314091e+17, 7.75562432e+17, 7.77821112e+17, 7.80089142e+17,
       7.82367618e+17, 7.84655553e+17, 7.86954043e+17, 7.89262101e+17,
       7.91580825e+17, 7.93909227e+17, 7.96248139e+17, 7.98597630e+17,
       8.00956967e+17, 8.03327249e+17, 8.05707490e+17, 8.08098790e+17,
       8.10500163e+17, 8.12912710e+17, 8.15335445e+17, 8.17769202e+17,
       8.20214051e+17, 8.22669264e+17, 8.25135673e+17, 8.27613349e+17,
       8.30101565e+17, 8.32601153e+17, 8.35112186e+17, 8.37633936e+17,
       8.40167237e+17, 8.42711894e+17, 8.45267968e+17, 8.47835785e+17,
       8.50414618e+17, 8.53005300e+17, 8.55607640e+17, 8.58221696e+17,
       8.60847530e+17, 8.63485201e+17, 8.66134770e+17, 8.68796298e+17,
       8.71469845e+17, 8.74155471e+17, 8.76853237e+17, 8.79563202e+17,
       8.82285428e+17, 8.85019711e+17, 8.87766887e+17, 8.90526255e+17,
       8.93297860e+17, 8.96082535e+17, 8.98879581e+17, 9.01689043e+17,
       9.04511750e+17, 9.07346744e+17, 9.10195099e+17, 9.13055858e+17,
       9.15929831e+17, 9.18817088e+17, 9.21716923e+17, 9.24630139e+17,
       9.27556549e+17, 9.30496205e+17, 9.33449419e+17, 9.36415488e+17,
       9.39395204e+17, 9.42388125e+17, 9.45395051e+17, 9.48415295e+17,
       9.51449147e+17, 9.54496655e+17, 9.57557611e+17, 9.60632806e+17,
       9.63721304e+17, 9.66824125e+17, 9.69940335e+17, 9.73070946e+17,
       9.76215027e+17, 9.79373334e+17, 9.82545913e+17, 9.85732071e+17,
       9.88932549e+17, 9.92147146e+17, 9.95375887e+17, 9.98618797e+17,
       1.00187565e+18, 1.00514719e+18, 1.00843272e+18, 1.01173225e+18,
       1.01504650e+18, 1.01837453e+18, 1.02171729e+18, 1.02507384e+18,
       1.02844487e+18, 1.03183014e+18, 1.03522987e+18, 1.03864337e+18,
       1.04207105e+18, 1.04551334e+18, 1.04896955e+18, 1.05243985e+18,
       1.05592398e+18, 1.05942254e+18, 1.06293461e+18, 1.06646098e+18,
       1.07000074e+18, 1.07355443e+18, 1.07712197e+18, 1.08070264e+18,
       1.08429694e+18, 1.08790434e+18, 1.09152535e+18, 1.09515921e+18,
       1.09880577e+18, 1.10246546e+18, 1.10613732e+18, 1.10982195e+18,
       1.11351835e+18, 1.11722688e+18, 1.12094712e+18, 1.12467880e+18,
       1.12842165e+18, 1.13217538e+18, 1.13593946e+18, 1.13971410e+18,
       1.14349823e+18, 1.14729214e+18, 1.15109471e+18, 1.15490600e+18,
       1.15872534e+18, 1.16255220e+18, 1.16638603e+18, 1.17022620e+18,
       1.17407189e+18, 1.17792288e+18, 1.18177780e+18, 1.18563627e+18,
       1.18949744e+18, 1.19335991e+18, 1.19722311e+18, 1.20108579e+18,
       1.20494664e+18, 1.20880482e+18, 1.21265841e+18, 1.21650647e+18,
       1.22034691e+18, 1.22417835e+18, 1.22799884e+18, 1.23180637e+18,
       1.23559878e+18, 1.23937370e+18, 1.24312849e+18, 1.24686070e+18,
       1.25056697e+18, 1.25424434e+18, 1.25788922e+18, 1.26149783e+18,
       1.26506609e+18, 1.26858956e+18, 1.27206341e+18, 1.27548276e+18,
       1.27884194e+18, 1.28213542e+18, 1.28535729e+18, 1.28850177e+18,
       1.29156367e+18, 1.29453964e+18, 1.29743263e+18, 1.30006841e+18,
       1.30233736e+18, 1.30422869e+18, 1.30574168e+18, 1.30687932e+18,
       1.30765062e+18, 1.30805466e+18, 1.30809328e+18, 1.30777322e+18,
       1.30710555e+18, 1.30610447e+18, 1.30478621e+18, 1.30316847e+18,
       1.30126929e+18, 1.29910671e+18, 1.29669831e+18, 1.29406064e+18,
       1.29120934e+18, 1.28815887e+18, 1.28492257e+18, 1.28151264e+18,
       1.27794022e+18, 1.27421561e+18, 1.27034822e+18, 1.26634679e+18,
       1.26221953e+18, 1.25797412e+18, 1.25361797e+18, 1.24915814e+18,
       1.24460151e+18, 1.23995486e+18, 1.23522485e+18, 1.23041808e+18,
       1.22554110e+18, 1.22060046e+18, 1.21560267e+18, 1.21055423e+18,
       1.20546157e+18, 1.20033110e+18, 1.19516916e+18, 1.18998201e+18,
       1.18477580e+18, 1.17955657e+18, 1.17433023e+18, 1.16910254e+18,
       1.16387910e+18, 1.15866525e+18, 1.15346584e+18, 1.14826580e+18,
       1.14302999e+18, 1.13789491e+18, 1.13283465e+18, 1.12784737e+18,
       1.12293166e+18, 1.11808607e+18, 1.11330902e+18, 1.10859874e+18,
       1.10395323e+18, 1.09937028e+18, 1.09484741e+18, 1.09038188e+18,
       1.08597068e+18, 1.08161051e+18, 1.07729777e+18, 1.07302856e+18,
       1.06879869e+18, 1.06460364e+18, 1.06043862e+18, 1.05629851e+18,
       1.05217791e+18, 1.04807110e+18, 1.04397212e+18, 1.03987468e+18,
       1.03577225e+18, 1.03165805e+18, 1.02752504e+18, 1.02336593e+18,
       1.01917324e+18, 1.01493928e+18, 1.01065615e+18, 1.00631578e+18,
       1.00190971e+18, 9.97429346e+17, 9.92865912e+17, 9.88210528e+17,
       9.83454213e+17, 9.78587915e+17, 9.73602541e+17, 9.68488982e+17,
       9.63238137e+17, 9.57840947e+17, 9.52288427e+17, 9.46571693e+17,
       9.40681993e+17, 9.34610748e+17, 9.28349574e+17, 9.21890325e+17,
       9.15225127e+17, 9.08346407e+17, 9.01246941e+17, 8.93919877e+17,
       8.86358784e+17, 8.78557680e+17, 8.70511084e+17, 8.62214034e+17,
       8.53662143e+17, 8.44851626e+17, 8.35779341e+17, 8.26442826e+17,
       8.16840337e+17, 8.06970877e+17, 7.96834239e+17, 7.86431032e+17,
       7.75762719e+17, 7.64831636e+17, 7.53641031e+17, 7.42195087e+17,
       7.30498935e+17, 7.18558687e+17, 7.06381440e+17, 6.93975299e+17,
       6.81349380e+17, 6.68513816e+17, 6.55479752e+17, 6.42259343e+17,
       6.28865742e+17, 6.15313088e+17, 6.01616471e+17, 5.87791907e+17,
       5.73856307e+17, 5.59827420e+17, 5.45723787e+17, 5.31564681e+17,
       5.17370038e+17, 5.03160374e+17, 4.88956710e+17, 4.74780474e+17,
       4.60653398e+17, 4.46597417e+17, 4.32634548e+17, 4.18786775e+17,
       4.05075923e+17, 3.91523519e+17, 3.78150673e+17, 3.64977938e+17,
       3.52025163e+17, 3.39311376e+17, 3.26854638e+17, 3.14671923e+17,
       3.02778993e+17, 2.91190291e+17, 2.79918843e+17, 2.68976183e+17,
       2.58372303e+17, 2.48115635e+17, 2.38213069e+17, 2.28670021e+17,
       2.19490564e+17, 2.10677604e+17, 2.02233124e+17, 1.94158481e+17,
       1.86454703e+17, 1.79122779e+17, 1.72163399e+17, 1.65550958e+17,
       1.56718758e+17, 1.49547679e+17, 1.42849646e+17, 1.36579161e+17,
       1.22980658e+17, 1.10660581e+17, 9.97670656e+16, 9.02547991e+16,
       8.18751263e+16, 7.43529455e+16, 6.75313461e+16, 6.14349389e+16,
       5.57225206e+16, 5.01433809e+16, 4.49124421e+16, 4.01203995e+16,
       3.57047627e+16, 3.15764452e+16, 2.77446627e+16, 2.41472435e+16,
       2.08649029e+16, 1.78769551e+16, 1.51696507e+16, 1.27391996e+16,
       1.05562286e+16, 8.59947631e+15, 6.86253321e+15, 5.30351228e+15,
       3.89948209e+15, 2.59444635e+15, 1.33716519e+15, 0])

        hfct_obj = HeatFlowCouplingTools()
        fluid_Te = np.loadtxt(os.path.join(myPath,'test_files/gdhohlraum_xmic_5ps_TekeV_interp'), skiprows=1)[:, 1] * 1E3 *(ELEMENTARY_CHARGE/BOLTZMANN_CONSTANT)
        fluid_Z = np.loadtxt(os.path.join(myPath,'test_files/gdhohlraum_xmic_Z_interp'), skiprows=1)[:, 1] 
        fluid_x_grid = np.loadtxt(os.path.join(myPath,'test_files/gdhohlraum_xmic_5ps_separatedsnbWcm2'), skiprows=1)[:, 0]*1e-6
        fluid_ne = np.loadtxt(os.path.join(myPath,'test_files/gdhohlraum_xmic_ne1e20cm3_interp'), skiprows=1)[:, 1] * (1e20 * 1e6)
        fluid_x_centered_grid = np.array([(fluid_x_grid[i] + fluid_x_grid[i+1])/2 for i in range(len(fluid_x_grid) - 1)])
        hfct_obj.electron_temperature = fluid_Te
        hfct_obj.electron_number_density = fluid_ne
        hfct_obj.zbar = fluid_Z
        hfct_obj.cell_wall_coord = fluid_x_grid
        hfct_obj.cell_centered_coord = fluid_x_centered_grid
        # hfct_obj.mass = fluid_mass
        hfct_obj.lambda_ei(hfct_obj.electron_temperature * (BOLTZMANN_CONSTANT/ELEMENTARY_CHARGE), 
                            hfct_obj.electron_number_density,
                            hfct_obj.zbar)
        hfct_obj.spitzerHarmHeatFlow()
        hfct_obj.snb = True
        hfct_obj.snb_heat_flow(20, 10, 2)
        rel_err = 100*(abs(hfct_obj.q_snb - true_snb_heat_flow) / true_snb_heat_flow)
        assert np.nanmax(rel_err) < 1e-6
